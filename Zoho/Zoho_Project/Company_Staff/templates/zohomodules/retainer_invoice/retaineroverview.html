{% extends 'base.html' %}
{% block content %}
{% load static %}
{% load social_share %}
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
                                                <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
                                                <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
                                                
                                                <script src="https://raw.githack.com/eKoopmans/html2pdf/master/dist/html2pdf.bundle.js"></script>
                                                <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
                                                <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css">
                                                <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>
                                                <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha384-ez8n5b/9F3JpKCEY6zIp+Hg7IbU8d7Q5ST78iEiRaP2mNPjkDps8I+1i0fblDOoh" crossorigin="anonymous">
                                                <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
                                                <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
                                                <script src="https://unpkg.com/htmx.org@1.9.6" integrity="sha384-FhXw7b6AlE/jyjlZH5iHa/tTe9EpJ1Y55RjcgPbjeWMskSxZt1v9qkxLJWNJaGni" crossorigin="anonymous"></script>
                                                <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
                                                <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
                                                <script type="text/javascript" src="https://unpkg.com/xlsx@0.15.1/dist/xlsx.full.min.js"></script>
                                                <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
                                                <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css">
                                                <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
                                                
                                                


                                                
                                                <style>


.btn.active {
        background-color: #ffc107;
        color: #000000;
    }
.company-info {
    text-align: center; /* Center align the text */
    margin-left: auto; /* Center the element horizontally */
    margin-right: auto; /* Center the element horizontally */
}

.company-info h2 {
    margin: 0;
    font-size: 2em;
}

.company-info p {
    margin: 0;
    line-height: 1.5;
}


 .dropdown-item:hover {
        color: rgb(226, 149, 5);
    }
                                                   .divider{
          margin: 1rem 0;
          border-bottom: 3px dotted black;
      }

                                                  .logo img {
        max-height: 100px;
    }
    .company-info h2 {
        margin: 0;
        font-size: 2em;
    }
    .company-info p {
        margin: 0;
        line-height: 1.5;
    }
    .i.invoice-box {
        background-color: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }

    .invoice-box h1 {
        font-size: 2em;
        margin-bottom: 20px;
    }

    .invoice-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .invoice-details p,
    .client-details p {
        margin: 5px 0;
    }





                                                  .bs{
                                                      box-shadow: 2px 2px 10px 3px rgba(0, 0, 0, 0.397);
                                                  }
                                                
                                                  .bs_sm{
                                                      box-shadow: inset 2px 2px 5px 3px rgba(0, 0, 0, 0.199);
                                                  }
                                                
                                                  .paiddiv{
                                                      color: black;
                                                      height: 10vh;
                                                      width: 20vh;
                                                      padding-left: 2vh;
                                                      padding-top: 1vh;
                                                      padding-bottom: 1vh;
                                                      margin-left: 7vh;
                                                      border-radius: 8px;
                                                      background-color: rgb(0, 0, 0);
                                                  }
                                                
                                                  .unpaiddiv{
                                                      color: black;
                                                      height: 10vh;
                                                      width: 20vh;
                                                      padding-left: 2vh;
                                                      padding-top: 1vh;
                                                      padding-bottom: 1vh;
                                                      margin-left: 7vh;
                                                      border-radius: 8px;
                                                      background-color: lightsteelblue;
                                                  }
                                                
                                                  .totaldiv{
                                                      color: black;
                                                      height: 10vh;
                                                      width: 20vh;
                                                      padding-left: 2vh;
                                                      padding-top: 1vh;
                                                      padding-bottom: 1vh;
                                                      margin-left: 7vh;
                                                      border-radius: 8px;
                                                      background-color: lightgreen;
                                                  }
                                                
                                                  #billtable tbody{
                                                      cursor: pointer;
                                                  }
                                                
                                                  #emptyMessage {
                                                      display: none;
                                                      font-size: x-large;
                                                      font-weight: bold;
                                                      color: red;
                                                  }
                                                
                                                  .dropdown {
                                                      position: relative;
                                                      display: inline-block;
                                                  }
                                                
                                                  .dropdown-content {
                                                      display: none;
                                                      position: absolute;
                                                      background-color: #fff;
                                                      box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
                                                      border-radius: 5px;
                                                      padding: 10px;
                                                      z-index: 1;
                                                      width: 15%;
                                                  }
                                                
                                                  .dropdown-content label {
                                                      display: block;
                                                      margin-bottom: 5px;
                                                  }
                                                
                                                  .dropdown-content input {
                                                      width: 100%;
                                                      padding: 5px;
                                                      box-sizing: border-box;
                                                      margin-bottom: 10px;
                                                  }
                                                
                                                  .tplus{
                                                      margin-top: 3vh;
                                                      margin-left: 5vh;
                                                      margin-right: -2vh;
                                                  }
                                                
                                                  .tequal{
                                                      margin-top: 3vh;
                                                      margin-left: 5vh;
                                                      margin-right: -2vh;
                                                  }
                                                
                                                  .tg{
                                                      color: rgb(0, 140, 7);
                                                  }
                                                
                                                  .tr{
                                                      color: rgb(218, 0, 0);
                                                  }
                                                
                                                  .tj{
                                                      color:#E4A11B;
                                                  }
                                                
                                                  .th{
                                                      color: rgb(12, 79, 234);
                                                  }
                                                
                                                  @media print{
                                                      body{
                                                          visibility: hidden !important; /* hide everything in body when in print mode*/
                                                      }
                                                
                                                      .printContainer {
                                                          visibility: visible !important; /* Override the rule above to only show the printables*/
                                                          position: absolute;
                                                          z-index: 99999;
                                                          top: 0;
                                                          left: 0;
                                                          width: 100%;
                                                          height: 100%;
                                                          font-size: large;
                                                      } 
                                                
                                                      #calcdiv{
                                                          visibility: visible;
                                                          margin-top: -30vh;
                                                          margin-left: -9vh;
                                                          margin-bottom: 30vh;
                                                      }
                                                
                                                      #billtable{
                                                          margin-top: 20vh;
                                                          margin-bottom: 20vh;
                                                      }
                                                
                                                      #billtable th{
                                                          font-size: medium;
                                                      }
                                                
                                                      .extra{
                                                          display: none;
                                                      }
                                                  }
                                                  
                                                  ::-webkit-scrollbar{
                                                      display: none
                                                  }
                                                </style>
                                                
                                                <style>
                                                   .modal {
                                                    z-index: 9999;
                                                    overflow: scroll;
                                                  }
                                                
                                                  .modal-content {
                                                    background-color: #fefefe;
                                                    margin: 15% auto;
                                                    padding: 20px;
                                                    border: 1px solid #888;
                                                    width: 80%;
                                                  }
                                                
                                                  /* Add your CSS styles here */
                                                  /* Styling for the filter input window */
                                                /* Styling for the filter input window */
                                                .filter-window {
                                                  display: none;
                                                  position: absolute;
                                                  padding: 10px;
                                                  color: aliceblue;
                                                  width: 10%;
                                                  background-color: rgb(37, 105, 99);
                                                  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
                                                  z-index: 1; /* Ensures the window is on top */
                                                }
                                                
                                                /* Additional styling for the filter input */
                                                .filter-window label, .filter-window input, .filter-window button {
                                                  display: block;
                                                  margin-bottom: 5px;
                                                }
                                                .filter-window button {
                                                    display: inline-block;
                                                    margin-right: 5px;
                                                    padding: 5px 10px;
                                                    background-color: #4CAF50; /* Green background color */
                                                    color: white; /* White text color */
                                                    border: none; /* Remove border */
                                                    border-radius: 3px; /* Optional: Add rounded corners */
                                                    cursor: pointer; /* Add a pointer cursor on hover */
                                                }
                                                
                                                .filter-window button:hover {
                                                    background-color: #45a049; /* Darker green on hover */
                                                }
                                                
                                                </style>
                                                  <meta name="viewport" content="width=device-width, initial-scale=1.0">
                                                  <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"> -->
                                                  <!-- <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script> -->
                                                  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script> -->
                                                  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
                                                  <style>
                                                    .scrollable-container {
                                                      border-right: 1px solid white;
                                                      overflow-y: scroll;
                                                      height: 84vh;
                                                    }
                                                  
                                                    .scrollable-container::-webkit-scrollbar {
                                                      width: 0; /* Set width to 0 to hide the scrollbar */
                                                    }
                                                    .company-info h2 {
                                                        margin-left: 230px;
                                                        font-size: 2em;
                                                    }
                                                    .company-info p {
                                                      margin-left: 230px;
                                                        line-height: 1.5;
                                                    }
                                                    .equal-length-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        height: 100%;
        /* Make the container fill the height of the column */
        margin-left: 2vh;
        margin-right: 2vh;
    }

    .equal-length-item {
        flex: 1;
        text-align: center;
    }

                                                  </style>
                                                  
                                                <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-xxxxxx" crossorigin="anonymous" />
                                                <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">




                                                

                                              
<div class="body-wrapper">
    <div class="container-fluid">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="{% url 'company_dashboard' %}" class="text-warning-emphasis">Dashboard</a></li>
              <li class="breadcrumb-item"><a href="" class="text-warning-emphasis">Retainer Invoices</a></li>
              <li class="breadcrumb-item" aria-current="page">Overview</li>
            </ol>
        </nav>
         <!-- ADD ITEM FORM -->
         <div class="card mb-3 bg-black shadow p-3 mb-5 rounded" style="max-width: 1400px;">
       
            
                                                            
          <div class="col-md-12" style="width: 120%;">
           <div class="row">
             <div class="col-md-3 scrollable-container" style="border-right: 4px solid rgb(75, 75, 75); overflow-y: scroll; height: 1090px;width: 25%;">
              
               <div class="row">
                 
                 <a class="text-white" style="font-size: 1.5rem;color: white; padding-left: 20px; padding-top: 20px;">All Retainer Invoices</a>
              
                 <br> 
                 <div class="col-md-6">
                  <input type="text"  id="searchInput" class="form-control text-black" style="border-color: rgb(201, 200, 199);background-color: #fefefe;" placeholder="Search...">


                </div>     
                 <div class="col-md-2">
                   <div class="dropdown">
                       <a class="btn text-center mt-2 btn-outline-warning btn-sm" id="sortbutton" data-bs-toggle="dropdown" role="button" style=" height: 34px;width:30px;">
                           <i style="padding-top: 2px; padding-bottom:2px; " class="fas fa-sort m-1"></i>
                       </a>
                       
                       <div class="dropdown-menu m-1" style="background-color: black; color: white;">
                        <a class="dropdown-item text-white" href="{% url 'retaineroverview' pk=invoice.pk %}">All</a>

                        <a class="dropdown-item text-white" href="#" onclick="sortTable()">Name</a>
                        <a class="dropdown-item text-white" href="#" onclick="sortTablebybillno()">Retainer Invoice Number</a>
                       </div>
                   </div>
               </div>
               <div class="col-md-2" style="padding-left: 10px; margin-left:-14px;">
                <div class="col-md-2 mt-2 mx-1" >
                    <a class="btn text-center btn-outline-warning btn-sm" data-bs-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" style=" height:34px;width:30px;">
                        <i class="fa fa-filter" style="padding-top:2px; padding-bottom:1px; "></i>
                    </a>
            
                    <div class="dropdown-menu m-1" style="background-color: #000;">
                      <a class="dropdown-item" href="{% url 'retaineroverview' pk=invoice.pk %}">All</a>
        <a class="dropdown-item" href="{% url 'retaineroverview' pk=invoice.pk %}?status=draft">Draft</a>
        <a class="dropdown-item" href="{% url 'retaineroverview' pk=invoice.pk %}?status=sent">Sent</a>
                    </div>
                </div>
                <div style="margin-left:45px; margin-top:-42px;">
                <a class="btn btn btn-outline-warning  btn-sm text-right mt-2" style="height: 35px; padding-top: 10px; padding-left:10px; padding-right:10px;"  style="font-size: small;" href="{% url 'new_retainer'%}">
                  <i class="fa fa-plus"></i>
              </a>
            </div>
            </div>
                
               <div class="col-md-" style="padding-left: 254PX;">
                
               </div>
               
              
               
   
               </div>
               <br>
               <div class="scrollable-table" style="width: 85%;margin-left: 20px;">
                 <div class="row">
                   
               </div>
   
          
             
             <br>
             <!-- Table 2: Billable Projects -->
             <table class="table  text-white" id="table2">
               <tbody>
                {% for invoice in invoices %}
                   <tr class="clickable" id="{{invoice.id}}">
                     <td class="justify-content-between align-items-center ">
                       <!-- <b ><a class="text-white"  href="">{{i.item_name}} </a></b>
                       <br>
                       <a class="text-white"  href="">{{i.hsn_code}}</a><br> -->
                       <label class="text-left d-block"><a class="text-white"  href="{% url 'retaineroverview' pk=invoice.id %}">{{invoice.retainer_invoice_number}} </a></label>
                       <br>
                       <label class="text-left d-block"><a class="text-white"  href="{% url 'retaineroverview' pk=invoice.id %}">{{ invoice.customer_name.customer_display_name }}</a></label>
                  
                     </td>
                     
                     <td>
                      {% if invoice.is_sent == False %}
                <label class="text-end d-block text-white">Draft</label>
                {% else %}
                <label class="text-end d-block text-white">Send</label>
                {% endif %}
                <br>
                <label class="text-end d-block text-white">₹{{ invoice.total_amount }}</label>
                     </td>
                   </tr></a>
                   {% endfor %}
               </tbody>
             </table>
             
 
   </div>
 </div>
 
 
  
  <div class="col" style="width: 300%;" id="overviewdiv" style="display: block;">
   <h1 class="text-light">Retainer Invoice</h1>
      <div class="row">
        <div class="col-md-7">
          <a class="text-white" style="font-size: 1.5rem;">
            <br>
            <h2 style="color: aliceblue;">{{selitem.item_name}}</h2>
          </a>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <a id="overviewBtn" class="btn btn-outline-warning xsmall_btn"   onclick="overview_function()"><i class="fas fa-eye"></i>
            Overview</a>
            


            <a class="btn btn-outline-warning xsmall_btn ms-1" onclick="template_function()"  data-bs-toggle="dropdown"
            id="attachmentDropdown" aria-haspopup="true" aria-expanded="false"
            ><i class="fa fa-file-alt"></i> Templates
        </a>

        <!-- <div class="dropdown-menu" aria-labelledby="attachmentDropdown">
            <a class="dropdown-item" onclick="template_function()"><i
                    class="fa fa-file-alt"></i> Template 1</a>

            <a class="dropdown-item" onclick="show_template2()"><i class="fa fa-file-alt"></i>
                Template 2</a>

            <a class="dropdown-item" onclick="show_template3()"><i class="fa fa-file-alt"></i>
                Template 3</a>
        </div> -->

        <button id="slipBtn" class="btn btn-outline-warning print-button" data-toggle="tooltip" title="Slip"
                                    onclick="show_slip()">
                                    <i class="fas fa-receipt"></i> slip</button>




           
          
              <script>
             
            
               
               
            </script>
            
  
  
        </div>
        <div id="overview_buttons">
          <!-- Overview buttons -->
          <!-- Place the buttons you want to show for Overview here -->
     
        <div class="col-sm-1 " style="margin-left:495px; margin-top:-40px;">
          <div class="col-md-6 d-flex justify-content-between align-items-center">

            {% if invoice.is_sent == False %}
            <a class="btn btn-outline-warning btn-sm mt-2 ms-1" onclick="convertToSaved({{ invoice.id }})" title="CONVERT" id="convert_btn">
                <i style="height:5px;" class="fa fa-exchange"></i>
            </a>
        {% endif %}
        

      
              <!-- Edit Button -->
              <a href="{% url 'retainer_edit_page' retainer_id=retainer_id %}" class="btn btn-outline-warning mt-2 ms-1 btn-sm"  title="Save this draft">
                  <i style="height:5px;" class="fas fa-pencil-alt"></i>
              </a>
      
              
      
              <!-- Delete Button -->
              <a href="{% url 'delete_retainer' retainer_id=invoice.id %}" class="delete fa fa-trash btn btn-outline-warning mt-2 ms-1 btn-sm" data-toggle="tooltip" title="DELETE" onclick="return confirm('Do you want to Delete this Item?');" style="margin-left: 4px; padding-top: 8px; padding-bottom: 8px;"></a>

              <!-- Attach button Button -->
              <a class="btn btn-outline-warning small_btn mt-2 ms-1 btn-sm" id="attach_btn" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="fas fa-paperclip" ></i> 
            </a>
          
                      
            <div class="dropdown-menu" aria-labelledby="attach_btn">
              <a class="dropdown-item text-black" data-toggle="modal" data-target="#retainer_files">Add Document</a>
              {% if invoice.document and invoice.document.url %} 
                  <a class="dropdown-item text-black" download href="{{ invoice.document.url }}">Download Document</a>
              {% endif %}
          </div>
          
           
              <a class="btn btn-outline-warning btn-sm" style="margin-left: 4px; margin-top: 5px;" id="comment_btn"  href="#commentsModal" data-toggle="modal"   title="COMMENTS">
                <i class="far fa-comment" style="padding-top: 3px; padding-bottom: 3px; "></i>
              </a>


              


              <a class="btn btn-outline-warning btn-sm" style="margin-left: 4px; margin-top: 5px;" id="history_btn"  href="#historyModal" data-toggle="modal"   title="HISTORY">
                <i class="fa-solid fa-clock-rotate-left"></i>
              </a>


              
              
          </div>
      </div>
    </div><br>


    <div id="template_buttons" style="display: none;">
      <div class="col-sm-1 " style="margin-left:500px; margin-top:-40px;">
        <div class="col-md-6 d-flex justify-content-between align-items-center">
      <!-- Template buttons -->
       <a class="btn btn-outline-warning small_btn mt-2 ms-1" style="font-size: 10px;margin-left: 4px; margin-top: 5px;"  title="SHARE" id="share_btn" data-bs-toggle="dropdown" aria-expanded="false">
                          <i class="fas fa-share" style="font-size: 10px;"></i>
                      </a>
                        <div class="dropdown-menu" aria-labelledby="share_btn">
                            <li class="text-black">{% post_to_whatsapp object_or_url "WhatsApp" %}</li>
                            
                            <a class="dropdown-item text-black" data-toggle="modal" data-target="#shareToEmail">Email</a>
                        </div>

                        <button href="" class="btn btn-outline-warning btn_print" style="font-size: 10px;margin-left: 4px; margin-top: 5px;" data-toggle="tooltip"
                        title="PDF" id="pdf-button">
                        <i class="far fa-file-pdf"></i></button>

                    <button class="btn btn-outline-warning print-button" style="font-size: 10px;margin-left: 4px; margin-top: 5px;" data-toggle="tooltip" title="Print"
                        id="print-button">
                        <i class="fa fa-print"></i></button>
                        <a class="btn btn-outline-warning btn-sm" style="margin-left: 4px; margin-top: 5px;" id="comment_btn"  href="#commentsModal" data-toggle="modal"   title="COMMENTS">
                          <i class="far fa-comment" style="padding-top: 3px; padding-bottom: 3px; "></i>
                        </a>
      <a class="btn btn-outline-warning btn-sm" style="margin-left: 4px; margin-top: 5px;" id="history_btn"  href="#historyModal" data-toggle="modal"   title="HISTORY">
        <i class="fa-solid fa-clock-rotate-left"></i>
      </a>
      </a>
      </div>
      </div>

      <!-- Place the buttons you want to show for Templates here -->
  </div>

  <div id="slip_buttons" style="display: none;">
    <div class="col-sm-1 " style="margin-left:540px; margin-top:-40px;">
      <div class="col-md-6 d-flex justify-content-between align-items-center">
    <!-- Slip buttons -->
    <a class="btn btn-outline-warning btn-sm" style="margin-left: 4px; margin-top: 5px;" id="comment_btn"  href="#commentsModal" data-toggle="modal"   title="COMMENTS">
      <i class="far fa-comment" style="padding-top: 3px; padding-bottom: 3px; "></i>
    </a>
    <a class="btn btn-outline-warning btn-sm" style="margin-left: 4px; margin-top: 5px;" id="history_btn"  href="#historyModal" data-toggle="modal"   title="HISTORY">
      <i class="fa-solid fa-clock-rotate-left"></i>
    </a>
    </div>
    </div>

    <!-- Place the buttons you want to show for Slip here -->
</div>
      </div><br>
  
      <div class="row" id="div-to-pdf"
        style="background-color: #c4c1c1fd;  height: auto; margin-left:1px; margin-right: 1rem; width: 700px;  ">
        <h5 style="margin-top:10px; color: green;">Created by:
         
          {% for entry in history_entries %}
         
{% if entry.created_by %}
<span style="color: black;">{{ entry.created_by.first_name }} {{ entry.created_by.last_name }}</span>
{% elif entry.modified_by %}
<span style="color: black;">{{ entry.modified_by.first_name }} {{ entry.modified_by.last_name }}</span>
{% endif %}

      {% endfor %}
        
       
        </h5>
        <h6 style="margin-left: 245px;margin-top:-25px;">{{invoice.retainer_invoice_date}}</h6>
        <h2 style="margin-left:10px;">#{{invoice.retainer_invoice_number}}</h2>
        <hr>
        <!-- <div class="row text-center">
          <h2 style="color: #000000;"><br>RETAINER INVOICE  
            <hr>
          </h2>
        </div>     -->
        <div class="row" id="div-to-pdf"
        style="background-color: #c4c1c1fd;  height: auto; margin-left:1px; margin-right: 1rem;width: 100%; ">
  
        
        <div class="gen-info col-6 " style="padding-left: 3rem; ">
          <h5 class="fw-bold" style="border-bottom: 1px solid rgba(128, 128, 128, 0.6); width: fit-content; margin-left:-55px;">Company Details</h5>
          <div class="d-flex px-3 justify-content-between text-black mb-2">
          <h6 style="margin-left:-25px;">Company</h6>
          <p class="mb-0 text-right">{{ details.company.company_name }}</p>
        </div>
        <div class="d-flex px-3 justify-content-between text-black mb-2">
          <h6 style="margin-left:-25px;">Mobile</h6>
          <p class="mb-0 text-right"> {{ details.company.contact }}</p>
        </div>
        <div class="d-flex px-3 justify-content-between text-black mb-2">
          <h6 style="margin-left:-25px;">Address</h6>
          <p class="mb-0 text-right" style="margin-left:95px;">  {{ details.company.address }}<br>
            {{ details.company.city }},
            {{ details.company.state }}<br>
            {{ details.company.pincode }}<br></p>
        </div>

        
        <h5 class="fw-bold" style="border-bottom: 1px solid rgba(128, 128, 128, 0.6); width: fit-content; margin-left:-55px;">Customer Details</h5>
          <div class="row mt-1">
            <div class="col-5"><label class="text-black" for="">Customer Name:</label></div>
            <div class="col-7">
              <p class="bold text-black" style="max-width: 15rem;word-wrap: break-word;">{{ customer_name }}</p>
            </div>
          </div>
          <div class="row mt-3">
            <div class="col-5"><label class="text-black" for="">Customer Mail ID:</label></div>
            <div class="col-7">
              <p class="bold text-black" style="max-width: 15rem;word-wrap: break-word;">{{ invoice.customer_mailid }} </p>
            </div>
          </div>
          <div class="row mt-3">
            <div class="col-5"><label class="text-black" for="">GST Treatment:</label></div>
            <div class="col-7">
              <p class="bold text-black" style="max-width: 15rem;word-wrap: break-word;">
                {{ gst_treatment }}</p>
            </div>
          </div>
          <div class="row mt-3">
            <div class="col-5"><label class="text-black" for="">GST Number:</label></div>
            <div class="col-7">
              <p class="bold text-black" style="max-width: 15rem;word-wrap: break-word;">
                {{ gst_number }}</p>
            </div>
          </div>
         
          <div class="row mt-3">
            <div class="col-5"><label class="text-black" for="">Place Of Supply:</label></div>
            <div class="col-7">
              <p class="bold text-black" style="max-width: 15rem;word-wrap: break-word;">
                {{ place_of_supply }}</p>
            </div>
          </div>
         
        <br>
       

        <h5 class="fw-bold" style="border-bottom: 1px solid rgba(128, 128, 128, 0.6); width: fit-content; margin-left:-55px;">Retainer Invoice Details</h5>
        <div class="d-flex px-3 justify-content-between text-black mb-2">
          <h6 style="margin-left:-25px;">Retainer Invoice No</h6>
          <p class="mb-0 text-right">{{invoice.retainer_invoice_number}}</p>
        </div>
        <div class="d-flex px-3 justify-content-between text-black mb-2">
          <h6 style="margin-left:-25px;">Retainer Invoice Date</h6>
          <p class="mb-0 text-right">{{invoice.retainer_invoice_date}}</p>
        </div>
        <div class="d-flex px-3 justify-content-between text-black mb-2">
          <h6 style="margin-left:-25px;">Address</h6>
          <p class="mb-0 text-right" style="margin-left:85px;">  {{ billing_address }}</p>
        </div>
        <div class="d-flex px-3 justify-content-between text-black mb-2">
          <h6 style="margin-left:-25px;">Payment Method</h6>
          {% if ret_payments.payment_opt %}
              
              <div class="row">
                 
                  <div class="col-sm-6 col-md-6 col-lg-6">
                      <label for=""><b>{{ ret_payments.payment_opt }}</b></label>
                  </div>
              </div>
              {% if ret_payments.acc_no %}
              <div class="row">
                  <div class="col-sm-6 col-md-6 col-lg-6">
                      <label class="text-black" for="" style="font-weight: 500; margin-left:8px;">Ac/No
                          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :</label>
                  </div>
                  <div class="col-sm-6 col-md-6 col-lg-6">
                      <label for=""><b>{{ ret_payments.acc_no }}</b></label>
                  </div>
              </div>
              {% endif %}
              {% if ret_payments.upi_id %}
              <div class="row">
                  <div class="col-sm-6 col-md-6 col-lg-6">
                      <label class="text-black" for="" style="font-weight: 500; margin-left:8px;">UPI
                          Id
                          &nbsp;&nbsp;&nbsp;
                          :</label>
                  </div>
                  <div class="col-sm-6 col-md-6 col-lg-6">
                      <label for=""><b>{{ ret_payments.upi_id }}</b></label>
                  </div>
              </div>
              {% endif %}
              {% if ret_payments.cheque_no %}
              <div class="row">
                  <div class="col-sm-6 col-md-6 col-lg-6">
                      <label class="text-black" for=""
                          style="font-weight: 500; margin-left:8px;">Cheque No
                          &nbsp;&nbsp;&nbsp;
                          :</label>
                  </div>
                  <div class="col-sm-6 col-md-6 col-lg-6">
                      <label for=""><b>{{ ret_payments.cheque_no }}</b></label>
                  </div>
              </div>
              {% endif %}
              {% endif %}
              
        </div>
       
        <hr style="width:570px;">
        <h5 class="fw-bold" style="border-bottom: 1px solid rgba(128, 128, 128, 0.6); width: fit-content; margin-left:-55px;">Item Details</h5>
        <!-- Add your desired section here -->
        {% for item in items %}
        
        <div class="row">
          
          <div class="col-12 mt-1"> <!-- Use col-12 to make it full width -->
              <div class="p-2" style="width: 100%;height: auto;background-color: #c4c1c1fd;border-radius: 5px;">
                 
                 
                  <div class="row">
                      <div class="col-12 " style="margin-left:-25px;">
                          <p   ><span class="text-dark">Item  </span><span style="margin-left: 155px;color: black; font-size: large;">{{ item.itemname }}</span></p>
                      </div>
                  </div>
                  {% if item.description %}
                  <div class="row" >
                      <div class="col-12 " style="margin-left:-25px;">
                          <p><span class="text-dark">Description </span><span style="margin-left: 155px;color: black; font-size: large;">{{ item.description }}</span></p>
                      </div>
                  </div>
                  {% endif %}
                  <div class="row">
                    <div class="col-12 " style="margin-left:-25px;">
                        <p   ><span class="text-dark">Hsn  </span><span style="margin-left: 155px;color: black; font-size: large;">{{ item.hsn }}</span></p>
                    </div>
                </div>
                  <div class="row">
                      <div class="col-12 " style="margin-left:-25px;">
                          <p><span class="text-dark">Rate </span><span style="margin-left: 155px;color: black; font-size: large;">{{ item.rate }}</span></p>
                      </div>
                  </div>
                  <div class="row">
                      <div class="col-12 " style="margin-left:-25px;">
                          <p><span class="text-dark">Quantity </span><span style="margin-left: 155px;color: black; font-size: large;">{{ item.quantity }}</span></p>
                      </div>
                  </div>
                  <div class="row">
                      <div class="col-12 " style="margin-left:-25px;">
                          <p><span class="text-dark">Amount</span><span  style="margin-left: 130px;color: black; font-size: large;" >{{ item.amount }}</span></p>
                      </div>
                  </div>
              </div>
          </div>
      </div>
      {% endfor %}

      
         
        <br><br>  
        
         
        
          
        </div>
       
        
        <div class="p-info col-6 text-white" style="height: 100%; margin-bottom: 1vh;">
          <div class="card text-white" style="background-color: rgb(0, 0, 0); padding-left: 2rem; padding-top: 1rem;">
            <h4 class=" text-white">Ret.Invoice Amount Details</h4>
              <div class="row mt-3">
                  <div class="col-sm-8 col-md-8 col-lg-8 ">
                      <label for="" style="font-weight: 500;">Retainer Invoice Status
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:</label>
                  </div>
                  <div class="col-sm-4 col-md-4 col-lg-4">
                      <label for="">  {% if invoice.is_sent == False %}
                        <label class="text-info" style="text-align: left; display: block; ">Draft</label>
                        {% else %}
                        <label style="text-align: left; display: block; color: #ffae1f;">Saved</label>
                        {% endif %}</label>
                  </div>
              </div>
              <br>
              <br>
              <div class="row mt-1">
                  <div class="col-sm-8 col-md-8 col-lg-8 ">
                      <label for=""
                          style="font-weight: 500;">Sub Total&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:</label>
                  </div>
                  <div class="col-sm-4 col-md-4 col-lg-4">
                      <label for="">{{ subtotal }}</label>
                  </div>
              </div>
              <br><br>
              <div class="row mt-1">
                  <div class="col-sm-8 col-md-8 col-lg-8 ">
                      <label for="" style="font-weight: 500;">Adjustment
                          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:</label>
                  </div>
                  <div class="col-sm-4 col-md-4 col-lg-4">
                      <label for="">{{ adjustment }}</label>
                  </div>
              </div>
              <hr>
              <div class="row mt-1">
                <div class="col-sm-8 col-md-8 col-lg-8 ">
                    <label for="" style="font-weight: 500;">Grand Total
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:</label>
                </div>
                <div class="col-sm-4 col-md-4 col-lg-4">
                    <label for="">{{ total }}</label>
                </div>
            </div>
            <hr>
              <div class="row mt-4">
                  <div class="col-sm-8 col-md-8 col-lg-8 ">
                      <label for="" style="font-weight: 500;">Paid
                          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                          :</label>
                  </div>
                  <div class="col-sm-4 col-md-4 col-lg-4">
                      <label for=""><b>{{invoice.advance }}</b></label>
                  </div>
              </div>
             <br>
              <div class="row">
                  <div class="col-sm-8 col-md-8 col-lg-8 ">
                      <label for="" style="font-weight: 500;">Balance
                          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                          :</label>
                  </div>
                  <div class="col-sm-4 col-md-4 col-lg-4">
                      <label for=""><b>{{ balance }}</b></label>
                  </div>
              </div>
              
              <hr>
              <!-- <h4 style="color: rgb(255, 255, 255);text-align: center;">Payment
                Details
            </h4>
              {% if ret_payments.payment_opt %}
              
              <div class="row">
                  <div class="col-sm-6 col-md-6 col-lg-6">
                      <label class="text-light" for=""
                          style="font-weight: 500;">Payment
                          Method &nbsp;&nbsp;&nbsp;
                          :</label>
                  </div>
                  <div class="col-sm-6 col-md-6 col-lg-6">
                      <label for=""><b>{{ ret_payments.payment_opt }}</b></label>
                  </div>
              </div>
              {% if ret_payments.acc_no %}
              <div class="row">
                  <div class="col-sm-6 col-md-6 col-lg-6">
                      <label class="text-light" for="" style="font-weight: 500;">Ac/No
                          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :</label>
                  </div>
                  <div class="col-sm-6 col-md-6 col-lg-6">
                      <label for=""><b>{{ ret_payments.acc_no }}</b></label>
                  </div>
              </div>
              {% endif %}
              {% if ret_payments.upi_id %}
              <div class="row">
                  <div class="col-sm-6 col-md-6 col-lg-6">
                      <label class="text-light" for="" style="font-weight: 500;">UPI
                          Id
                          &nbsp;&nbsp;&nbsp;
                          :</label>
                  </div>
                  <div class="col-sm-6 col-md-6 col-lg-6">
                      <label for=""><b>{{ ret_payments.upi_id }}</b></label>
                  </div>
              </div>
              {% endif %}
              {% if ret_payments.cheque_no %}
              <div class="row">
                  <div class="col-sm-6 col-md-6 col-lg-6">
                      <label class="text-light" for=""
                          style="font-weight: 500;">Cheque No
                          &nbsp;&nbsp;&nbsp;
                          :</label>
                  </div>
                  <div class="col-sm-6 col-md-6 col-lg-6">
                      <label for=""><b>{{ ret_payments.cheque_no }}</b></label>
                  </div>
              </div>
              {% endif %}
              {% endif %} -->
          </div>
      </div>
      
  </div>

  </div>


    <!-- Templates-->
    <div id="template1" style="display: none;" class="printTemplates template1">
      <div class="my-3 page"  style="background-color: white; width:700px; "
          id="selected-area">
          <div class="p-5">
              <div style="background-color: #ffae1f;border-radius: 1rem;padding: 20px;display:flex;align-items: center;">
  
                <div  class="status-label" style="width:60px; text-align:center;">
               
          {% if invoice.is_sent == False %}
          <label style="text-align: left; display: block; color: black;">Draft</label>
          {% else %}
          <label style="text-align: left; display: block; color: black;">Saved</label>
          {% endif %}
          
        </div>
        <div style="flex-grow: 1; text-align: center;">
          <h1 class="text-white" style="margin: 0;">RETAINER INVOICE</h1>
        </div>
        <div style="flex-grow: 1; text-align: right;">
          <h4 class="text-white" style="margin: 0;">{{ invoice.retainer_invoice_number }}</h4>
        </div>
              </div>
             
              <div class="row mt-5">
                  <div class="col-md-8">
                    <h5>FROM,</h5>
                      <h4 class="text-dark" style="font-weight: bold;">
                        {{ details.company.company_name }}</h4>
                      <p class="address" style="font-weight: bold;color: #000;">
                        {{ details.company.address }}<br>
                        {{ details.company.city }},
                        {{ details.company.state }}<br>
                        {{ details.company.pincode }}<br>
                        {{ details.login_details.email }}<br>
                        {{ details.company.contact }}<br>
                      </p>
                  </div>
                  <div class="col-md-4">
                      <div class="top-left">
                          <div class="graphic-path">
                              <p>Retainer Invoice #:<b>{{invoice.retainer_invoice_number }}</b>
                              </p>
                          </div>
                          <div class="mt-2">

                              <p style="color: #000;">Date:
                                  <b>{{ invoice.retainer_invoice_date | date:'d-m-Y'}}</b>
                              </p>
                          </div>
                      </div>
                  </div>
              </div>
              <section class="top-content bb d-flex justify-content-between">
                  <div class="logo">

                  </div>

              </section>

              <section class="store-user">
                  <div class="col-12">
                      <div class="row bb pb-2 mt-3">
                          <div class="col-4 pl-0">
                              <label class="text-white  w-100 p-1" style="background-color: #ffae1f;"><b>BILL
                                      TO</b></label>
                              <h5 class="" style="font-weight: bold; color: #080808;">
                                {{ customer_name }}</h5>
                              <p class="address" style="font-weight: bold;color: #000;">
                                {{ customer_email }}
                                  <br>
                                  {{ place_of_supply }}
                                  <br>

                                  <span>Mob: </span><b>{{ cust.phone1 }}</b>
                              </p>
                          </div>
                          <div class="col-4"></div>
                          <div class="col-4 pr-0">
                              <label class="text-white  w-100 p-1" style="background-color: #ffae1f;"><b>GST
                                      Details</b></label>
                              <h5 class="" style="font-weight: bold; color: #0e0d0d;">
                                  {{gst_treatment}}</h5>
                              <p class="address" style="font-weight: bold;color: #000;">
                                  {{ gst_number}}
                              </p>
                          </div>
                      </div>

                  </div>
              </section>

              <section class="product-area mt-2">
                  <table class="table table-hover table-bordered" style="border-color: black;" >
                      <thead style="background-color: #ffae1f">
                          <tr class="">
                              <th class="text-center" style="color:#050505;">Items</th>
                              <th class="text-center" style="color:#050505;">Description</th>
                              <th class="text-center" style="color:#050505;">Rate</th>
                              <th class="text-center" style="color:#050505;">Hsn</th>
                              <th class="text-center" style="color:#050505;">Quantity</th>
                              <th class="text-center" style="color:#050505;">Amount</th>
                          </tr>
                      </thead>
                      <tbody>
                          {% for itm in items %}
                          <tr>
                              <td class="text-center" style="color:#000">{{ itm.itemname }}</td>
                              <td class="text-center" style="color:#000">{{ itm.description }}
                              </td>
                              <td class="text-center" style="color:#000">{{ itm.rate }}</td>
                              <td class="text-center" style="color:#000">{{ itm.hsn }}</td>
                              <td class="text-center" style="color:#000">{{ itm.quantity }}</td>
                              <td class="text-center" style="color:#000">{{ itm.amount }}</td>

                          </tr>
                          {% endfor %}
                      </tbody>
                  </table>
              </section>

              <section class="balance-info">
                  <div class="row mt-3">
                      <div class="col-4">
                          <table class="table table-borderless">
                              <tbody>

                                  <!-- <tr >
                                      <td style="color: #000;text-align: left;">Payment Type</td>
                                      <td style="color: #000;text-align: left;">:</td>
                                      {% if bank %}
                                      <th style="color: #000;text-align: center;">{{bank.bankname}}</th>
                                      {% else %}
                                      <th style="color: #000;text-align: center;">{{pbill.payment_type}}</th>
                                      {% endif %}
                                  </tr>
                                  <tr>
                                      <td></td>
                                      <td></td>
                                      <td></td>
                                      
                                  </tr> -->
                                  {% if ewbill.note %}
                                  <tr>
                                      <td style="color: #000;text-align: left;">Note</td>
                                      <td style="color: #000;text-align: left;">:</td>
                                      <th style="color: #000;text-align: center;">{{ewbill.note}}
                                      </th>
                                  </tr>
                                  {% endif %}

                              </tbody>
                          </table>
                      </div>
                      <div class="col-4"></div>
                      <div class="col-4">
                          <table class="table table-borderless">
                              <tbody>
                                  <tr>
                                      <td style="color: #000; white-space: nowrap;">Sub Total</td>
                                      <td style="color: #000;">:</td>
                                      <td class="text-center" style="color: #000;">
                                          {{invoice.total_amount}}</td>
                                  </tr>
                                  {% if invoice.advance %}
                                  <tr>
                                      <td style="color: #000;">Advance</td>
                                      <td style="color: #000;">:</td>
                                      <td class="text-center" style="color: #000;">
                                          {{invoice.advance}}</td>
                                  </tr>
                                  <tr>
                                      <td style="color: #000;">Balance</td>
                                      <td style="color: #000;">:</td>
                                      <td class="text-center" style="color: #000;">
                                          {{invoice.balance}}</td>
                                  </tr>
                                  {% endif %}
                              </tbody>

                          </table>

                      </div>
                  </div>
                 
              </section>

          </div>
          
      </div>
      <div id="templateToggle" class="templateToggleSegment mt-3 mb-0 w-100 d-flex justify-content-center">
        <button id="toggleTemplate1" onclick="template_function()" class="btn btn-outline-warning btn-sm m-2 active templateToggleButtons">1</button>
        <button id="toggleTemplate2" onclick="show_template2()" class="btn btn-outline-warning btn-sm m-2 templateToggleButtons">2</button>
        <button id="toggleTemplate3" onclick="show_template3()" class="btn btn-outline-warning btn-sm m-2 templateToggleButtons">3</button>
      </div>
  </div>

  <div class="mt-3 " id="template2"
      style="display: none;height:800px;width:700px; margin-left: -1vh">

      <section  id="selected-area2" style="background-color: white; height: 800px;" class=" p-2 m-2">
          <header style="	border-radius: 1rem;">
             <br><br>
              <div style="border-radius: 1rem;padding: 20px;display:flex;align-items: center;">
  
                <div  class="status-label bg-warning" style="width:60px; text-align:center;">
               
          {% if invoice.is_sent == False %}
          <label style="text-align: left; display: block; color: black;">Draft</label>
          {% else %}
          <label style="text-align: left; display: block; color: black;">Saved</label>
          {% endif %}
        
        </div>
        <div style="flex-grow: 1; text-align: center; margin-left:18px; ">
          <h4 class="text-dark fw-bold" style="font-weight: bold  !important;" >RETAINER INVOICE</h4>
        </div>
        <div style="flex-grow: 1; text-align: right;">
          <h4 class="text-dark" style="margin: 0;">{{ invoice.retainer_invoice_number }}</h4>
        </div>
              </div>
            
              <hr>
          </header>
          <div class="invoice-box">
            <div class="row">
              <div class="col">
            
            <div class="company-details"  style="color:black;">
              <p class="bg-warning" style="border-top-right-radius: 4vh; border-bottom-right-radius: 4vh; width: fit-content; padding: 5px 60px 5px 10px;"><b class="text-black">COMPANY ADDRESS</b>,</p>
              <h2 class="text-dark">{{details.company.company_name}}</h2>
              <p class="text-dark"> {{details.company.address}}<br>{{details.company.city}}</p>
              <p> {{details.company.contact}}</p>
              <p>{{details.login_details.email}}</p>
          </div>
              </div>
              <div class="col">
          <div class="client-details" style="width: 50vh;">
            <p class="bg-warning" style="border-top-right-radius: 4vh; border-bottom-right-radius: 4vh; width: fit-content; padding: 5px 60px 5px 10px;"><b class="text-black">BILLING ADDRESS</b>,</p>
              <table>
                  <tr>
                      <td class="table-cell text-black" style="border: none;">
                          <b>{{ customer_name }}</b>
                      </td>
                  </tr>
                
                  <tr>
                      <td class="table-cell text-black" style="border: none;">
                        {{ billing_address }} </td>
                  </tr>
                
                  <tr>
                      <td class="table-cell text-black" style="border: none;">
                          {{gst_treatment}}</td>
                  </tr>
                  
                  <tr>
                      <td class="table-cell text-black" style="border: none;">
                          {{gst_number}}</td>
                  </tr>
                  
              </table>
          </div>
          </div>
          </div>
          <hr>
              <div class="invoice-header">
                  <div class="invoice-details text-dark">
                      <table>
                          <tr>
                             
                              
                              
                          </tr>
                          <tr>
                              <td  class="table-cell text-black" style="border: none; font-weight: bold  !important;" ><h4>Retainer
                                  Invoice
                                  Date
                                </h4></td>
                              <td class="table-cell text-black" style="border: none;">:</td>
                              <td class="table-cell text-black" style="border: none;">
                                 <h4> {{invoice.retainer_invoice_date|date:'d-m-Y'}} </h4></td>
                          </tr>

                      </table>
                  </div>
                  
              </div>
              <br>
<hr>
              <table class="table table-hover table-bordered" style="border-color: black;">
                  <thead style="background-color: #ffae1f;">
                      <tr>

                          <th id="th" style="text-align: center;">Product</th>
                          <th id="th" style="text-align: center;">Description</th>
                          <th id="th" style="text-align: center;">Rate</th>
                          <th id="th" style="text-align: center;">Hsn</th>
                          <th id="th" style="text-align: center;">Quantity</th>
                          <th id="th" style="text-align: center;"> Amount</th>
                      </tr>
                  </thead>
                  <tbody>
                      {% for i in items %}
                      <tr style="color: black;">
                          <td style="text-align: center;">{{i.itemname}}</td>
                          <td style="text-align: center;">{{i.description}}</td>
                          <td style="text-align: center;">{{i.rate}}</td>
                          <td style="text-align: center;">{{i.hsn}}</td>
                          <td style="text-align: center;">{{i.quantity}}</td>
                          <td style="text-align: center;">{{i.amount}}</td>
                      </tr>
                      {% endfor %}

                  </tbody>
              </table><br>

              <div class="invoice-total">
                  <div class="row">
                      <div class="col-5"></div>
                      <div class="col-4">
                          <table style="margin-left: 20vh; ">
                              <tr>
                                  <td class="table-cell text-black" style="border: none;">
                                      Subtotal
                                  </td>
                                  <td class="table-cell text-black" style="border: none;">:
                                  </td>
                                  <td class="table-cell text-black" style="border: none;">
                                      <b>{{invoice.total_amount}}</b>
                                  </td>
                              </tr>
                              {% if invoice.advance %}
                              <tr>
                                  <td class="table-cell text-black" style="border: none;">
                                      Advance
                                  </td>
                                  <td class="table-cell text-black" style="border: none;">:
                                  </td>
                                  <td class="table-cell text-black" style="border: none;">
                                      <b>{{invoice.advance}}</b>
                                  </td>
                              </tr>
                              <tr>
                                  <td class="table-cell text-black" style="border: none;">
                                      Balance
                                  </td>
                                  <td class="table-cell text-black" style="border: none;">:
                                  </td>
                                  <td class="table-cell text-black" style="border: none;">
                                      <b>{{invoice.balance}}</b>
                                  </td>
                              </tr>
                              {% endif %}

                          </table>
                      

                  </div>

              </div>

          </div>

          
          
      </section>
      <div id="templateToggle" class="templateToggleSegment mt-3 mb-0 w-100 d-flex justify-content-center">
        <button id="toggleTemplate1" onclick="template_function()" class="btn btn-outline-warning btn-sm m-2  templateToggleButtons">1</button>
        <button id="toggleTemplate2" onclick="show_template2()" class="btn btn-outline-warning btn-sm m-2 active  templateToggleButtons">2</button>
        <button id="toggleTemplate3" onclick="show_template3()" class="btn btn-outline-warning btn-sm m-2 templateToggleButtons">3</button>
      </div>
  </div>

  <div id="template3" class="template3" style="display: none;">
      <div class="my-5 page"  style="background-color: white; width: 700px; height: 840px;">
          <div  id="selected-area3">
            <div style="background-image: linear-gradient(#ffae1f, black); color: white;">
              <section class="top-content "
                  >
                  <div class="logo">
                      <!-- <img src="logo.png" alt="" class="img-fluid"> -->
                  </div>
                  <div style="margin-right:8px !important;" class="top-left">
                    <p style="font-size: 4vh; text-align: center;">RETAINER INVOICE</p>
                      <div  style="color: white; text-align: center;" >
                        <p class="text-white" >{{details.company.company_name}}</p>
                        <p class="text-white"> {{details.company.address}}<br>{{details.company.city}}</p>
                        <p> {{details.company.contact}}</p>
                        <p>{{details.login_details.email}}</p>
                    </div>
                  </div>
              </section>
            </div>
              <section style="margin-left:25px;" class="store-user mt-5">
                  <div class="col-12">
                      <div class="row bb pb-3">
                          <div class="col-7">
                              <p>FROM,</p>
                              <h5>{{details.company.company_name }}</h5>
                              <p class="address "> {{details.company.address}}<br>
                                  {{details.company.city}},
                                  {{details.company.state}}<br>
                                  {{details.company.pincode}}<br>
                              </p>

                          </div>
                          <div class="col-5">
                              <p>TO,</p>
                              <h5>{{customer_name}}</h5>
                              <p class="address col-9" style="margin-left: 0px;">
                                  {{billing_address}} </p><br>
                              <p class="address col-9">{{gst_treatment}}</p><br>
                              <p class="address col-9">{{gst_number}}</p>


                          </div>
                      </div>
                      <div class="row extra-info pt-3">
                          <div class="col-7">
                              <p>Reatiner Invoice Date:
                                  <span>{{invoice.retainer_invoice_date |date:'d-m-Y'}}</span>
                              </p>
                          </div>

                      </div>
                  </div>
              </section>

              <section style="margin-left:25px;" class="product-area mt-4">
                  <table class=" table table-hover table-bordered " id="table1">
                      <thead style="background-color: #ffae1f;">
                          <tr>
                              <td style="text-align: center; font-weight:bold; color:black ">Items
                              </td>
                              <td style="font-weight:bold; color:black">Description</td>
                              <td style="font-weight:bold; color:black">Rate</td>
                              <td style="font-weight:bold; color:black">Hsn</td>
                              <td style="font-weight:bold; color:black">Quantity</td>
                              <td style="font-weight:bold; color:black">Amount</td>

                          </tr>
                      </thead>
                      <tbody>

                          {% for j in items %}
                          <tr>
                              <td style="color:black; text-align: center;">
                                  {{j.itemname}}
                              </td>
                              <td style="color:black">{{j.description}}</td>
                              <td style="color:black">{{j.rate}}</td>
                              <td style="color:black">{{j.hsn}}</td>
                              <td style="color:black">{{j.quantity}}</td>
                              <td style="color:black">{{j.amount}} </td>

                          </tr>
                          {% endfor %}
                      </tbody>
                  </table><br><br>
              </section>

              <section class="balance-info">
                  <div class="row mt-3">
                      <div class="col-2"></div>
                      <div class="col-4"></div>

                      <div class="col-4">
                          <table class="table table-borderless">
                              <tbody>
                                  <tr>
                                      <td style="color: #000;">Sub Total</td>
                                      <td style="color: #000;">:</td>
                                      <td class="text-right" style="color: #000;">
                                          {{invoice.total_amount}}</td>
                                  </tr>
                                  {% if invoice.advance %}
                                  <tr>
                                      <td style="color: #000;">Advance</td>
                                      <td style="color: #000;">:</td>
                                      <td class="text-right" style="color: #000;">
                                          {{invoice.advance}}</td>
                                  </tr>
                                  <tr>
                                      <td style="color: #000;">Balance</td>
                                      <td style="color: #000;">:</td>
                                      <td class="text-right" style="color: #000;">
                                          {{invoice.balance}}</td>
                                  </tr>
                                  {% endif %}


                              </tbody>

                          </table>

                      </div>

                     
                  </div>
              </section>

              <!-- Cart BG -->
              <img src="cart.jpg" class="img-fluid cart-bg" alt="">

              <!-- <footer>
                          <hr>
                          <p class="m-0 text-center">
                              View THis Invoice Online At - <a href="#!"> invoice/saburbd.com/#868 </a>
                          </p>
                          <div class="social pt-3">
                              <span class="pr-2">
                                  <i class="fas fa fa-mobile-alt"></i>
                                  <span>0123456789</span>
                              </span>
                              <span class="pr-2">
                                  <i class="fas fa fa-envelope"></i>
                                  <span>me@saburali.com</span>
                              </span>
                              <span class="pr-2">
                                  <i class="fab fa-facebook-f"></i>
                                  <span>/sabur.7264</span>
                              </span>
                              <span class="pr-2">
                                  <i class="fab fa-youtube"></i>
                                  <span>/abdussabur</span>
                              </span>
                              <span class="pr-2">
                                  <i class="fab fa-github"></i>
                                  <span>/example</span>
                              </span>
                          </div>
                      </footer> -->
          </div>
      </div>
      <div id="templateToggle" class="templateToggleSegment mt-3 mb-0 w-100 d-flex justify-content-center">
        <button id="toggleTemplate1" onclick="template_function()" class="btn btn-outline-warning btn-sm m-2 templateToggleButtons">1</button>
        <button id="toggleTemplate2" onclick="show_template2()" class="btn btn-outline-warning btn-sm m-2 templateToggleButtons">2</button>
        <button id="toggleTemplate3" onclick="show_template3()" class="btn btn-outline-warning btn-sm m-2 active  templateToggleButtons">3</button>
      </div>
  </div>

  <fieldset2 id="est_slip" style="display: none;">
      <div style="background-color: rgb(0, 0, 0);" class="mx-2 my-4">

          <div class="my-5 slip-page" style="width: 700px;">
              <div class="row" style="margin-top: 20%; " id="printslip">
                  <div class="col-md-3"></div>
                  <div class="col-md-7">
                      <div class="card bg-white" style="border: 1px dotted black;padding: 20px;">
                          <div class="mt-2" style="text-align: center;padding: 15px;">
                              <div class="text-center" style="font-size: 3vh; color: black;">
                                  <b> {{ details.company.company_name }} </b>
                              </div>
                              <span style="font-size:medium; color: black;">{{ details.company.address }}
                                  <br>
                                  {{ details.company.city }},
                                  {{ details.company.state }}
                                  {{ details.company.pincode }}  <br>
                                  {{ details.company.contact }} <br> {{ details.login_details.email }}
                              </span>
                          </div>
                          <div class="divider"></div>
                          <div class="ml-4 mt-2" style="color: black;">
                              <div class="row">
                                  <div class="col-md-6 text-left">Retainer Invoice No:</div>
                                  <div class="col-md-5 text-right">
                                      {{invoice.retainer_invoice_number}}</div>
                              </div>
                              <div class="row">
                                  <div class="col-md-6 text-left">Customer Name:</div>
                                  <div class="col-md-5 text-right">{{cust.customerName}}
                                  </div>
                              </div>
                              <div class="row">
                                  <div class="col-md-6 text-left">Retainer Invoie Date :</div>
                                  <div class="col-md-5 text-right">
                                      {{invoice.retainer_invoice_date |date:'d-m-Y'}}
                                  </div>
                              </div>
                          </div>
                          <div class="divider"></div>
                          <div><br>
                              <div class="equal-length-container"
                                  style="color: black; font-weight: bold;">
                                  <div class="equal-length-item" style=" text-align: center;">
                                      Product
                                      <hr
                                          style="border-bottom: 1px solid black; margin-top:1vh; width:95%">
                                  </div>
                                  <div class="equal-length-item ml-1" style=" text-align:center;">
                                      Description
                                      <hr
                                          style="border-bottom: 1px solid black; margin-top:1vh; width:99%;">
                                  </div>
                                  <div class="equal-length-item" style=" text-align:center;">
                                      Rate
                                      <hr
                                          style="border-bottom: 1px solid black; margin-top:1vh; width:95%;">
                                  </div>
                                  <div class="equal-length-item" style=" text-align:center;">
                                   Hsn
                                    <hr
                                        style="border-bottom: 1px solid black; margin-top:1vh; width:95%;">
                                </div>
                                  <div class="equal-length-item" style=" text-align: center; ">
                                      Qty
                                      <hr
                                          style="border-bottom: 1px solid black; margin-top:1vh; width:95%">
                                  </div>



                                  <div class="equal-length-item" style=" text-align: center; ">
                                      Amount
                                      <hr
                                          style="border-bottom: 1px solid black; margin-top:1vh; width:95%">
                                  </div>
                              </div>
                          </div>
                          <div>
                              {% for j in items %}
                              <div class="equal-length-container"
                                  style="color: black; font-size: small; word-wrap: break-word; margin-bottom: 1vh;">
                                  <div class="equal-length-item"
                                      style="text-align: center; margin-left: 2px;">
                                      {{j.itemname}}
                                  </div>
                                  <div class="equal-length-item" style="text-align: right;">
                                      {{j.description}}
                                  </div>
                                  <div class="equal-length-item" style="text-align: center;">
                                      {{j.rate}}
                                  </div>
                                  <div class="equal-length-item" style="text-align: center; ">
                                    {{j.hsn}}
                                </div>
                                  <div class="equal-length-item" style="text-align: center; ">
                                      {{j.quantity}}
                                  </div>
                                  <div class="equal-length-item" style="text-align: center; ">
                                      {{j.amount}}
                                  </div>
                              </div>
                              {% endfor %}
                          </div>
                          {% if invoice.advance %}
                          <div><br>
                              <div class="row">
                                  <div class="col-md-5 text-left" style=" color: black;">
                                      Sub Total
                                  </div>
                                  <div class="col-md-6" style="color: black;text-align: end;">
                                      {{ invoice.total_amount }}
                                  </div>
                              </div>
                              <div class="row">
                                  <div class="col-md-5" style=" color: black;">
                                      Advance
                                  </div>
                                  <div class="col-md-6" style="color: black;text-align: end;">
                                      {{ invoice.advance }} </div>
                              </div>
                              <div class="row">
                                  <div class="col-md-5 text-left" style=" color: black;">
                                      Balance
                                  </div>
                                  <div class="col-md-6" style="color: black; text-align: end;">
                                      {{ invoice.balance }} </div>
                              </div>
                              <hr class="ml-2 mr-2"
                                  style="color: black; border-bottom: 1px solid black; ">
                          </div>

                          <div class="mb-2">
                              <div class="row">
                                  <div class="col-md-5 text-left ml-2"
                                      style=" font-size: large; color: black; font-weight: bold;">
                                      Total
                                  </div>
                                  <div class="col-md-6"
                                      style="font-size: large; color: black; font-weight: bold;text-align: end;">
                                      {{invoice.total_amount}}
                                  </div>
                              </div>
                          </div>
                          {% else %}
                          <div><br>

                            <div class="divider"></div>
                          </div>

                          <div class="mb-2">
                              <div class="row">
                                  <div class="col-md-5 text-left ml-2"
                                      style=" font-size: large; color: black; font-weight: bold;">
                                      Total
                                  </div>
                                  <div class="col-md-6"
                                      style="font-size: large; color: black; font-weight: bold;text-align: end;">
                                      {{invoice.total_amount}}
                                  </div>
                              </div>
                          </div>
                          {% endif %}
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </fieldset2>

  </div>
  
      <div class="col" style="width: 300%;" id="Transaction" style="display: none;">
        <div class="row">
          <div class="col-md-7">
            <a class="text-white" style="font-size: 1.5rem;">
              <br>
              <h2 style="color: aliceblue;">{{selitem.item_name}}</h2>
            </a>
          </div>
        </div>
        
         
        
    
       
    </div>
    </div>
    </div>
    </div>
    </div>
    </div>
    </body>
    <style>
      @media print {
          .text-right-print {
              text-align: right !important;
          }
      }
  </style>
    <script>
    function searchTable() {
      // Declare variables
      var input, filter, table, tr, td, i, txtValue;
      input = document.getElementById("searchInput2");
      filter = input.value.toUpperCase();
      table = document.getElementById("table1");
      tr = table.getElementsByTagName("tr");
    
      // Loop through all table rows, and hide those that don't match the search query
      for (i = 0; i < tr.length; i++) {
        td = tr[i].getElementsByTagName("td")[0]; // Adjust index based on the column you want to search
        if (td) {
          txtValue = td.textContent || td.innerText;
          if (txtValue.toUpperCase().indexOf(filter) > -1) {
            tr[i].style.display = "";
          } else {
            tr[i].style.display = "none";
          }
        }
      }
    }
    </script>
  <div id="filterWindow" class="filter-window">
    <!-- <label for="filterInput">Enter filter text:</label> -->
    <input type="text" id="filterInput">
    <button onclick="applyFilter()">Apply</button>
    <button onclick="clearFilter()">Clear</button>
  </div>
    <script>
      function clearFilter() {
      document.getElementById('filterInput').value = '';
      // Implement your logic to clear the filter and update the table accordingly
      // For simplicity, you can just log the action to the console
      console.log('Filter Cleared');
      // Close the filter window
      document.getElementById('filterWindow').style.display = 'none';
  }
  
      // JavaScript functions
      function showFilter(columnName, thElement) {
      var filterWindow = document.getElementById('filterWindow');
      filterWindow.style.display = 'block';
      
      // Set the position of the filter window near the th element
      var thRect = thElement.getBoundingClientRect();
      filterWindow.style.top = thRect.bottom + 'px';
      filterWindow.style.left = thRect.left + 'px';
  
      // You can customize the filter window based on the column clicked
      // For simplicity, I'm setting the label text to the column name
      filterWindow.querySelector('label').innerText = 'Enter filter text for ' + columnName + ':';
  }
  
  </script>
      <div class="row mt-3">
        <div class="col-5"><label class="text-dark" for=""> </label></div>
        <div class="col-7">
          <p class="bold text-dark" style="max-width: 15rem;word-wrap: break-word;">  </p>
        </div>
      </div>
      <div class="row mt-3">
        <div class="col-5"><label class="text-dark" for=""> </label></div>
        <div class="col-7">
          <p class="bold text-dark" style="max-width: 15rem;word-wrap: break-word;">  </p>
        </div>
      </div>
      <div class="row mt-3">
        <div class="col-5"><label class="text-dark" for=""> </label></div>
        <div class="col-7">
          <p class="bold text-dark" style="max-width: 15rem;word-wrap: break-word;">  </p>
        </div>
      </div>
    </div>
    </div>
        </div>
        </div>
    </div>  </div>
  
           
  <!-- SORT  AND FILTER SCRIPT -->
  <script>
      $(document).ready(function() {
          // Event listener for dropdown menu links
          $('.dropdown-item-filter-account-type').click(function() {
              // Get the selected account type
              var selectedType = $(this).text().toLowerCase();
      
              // Show/hide table rows based on the selected account type
              $('.account-row').each(function() {
                  var accountType = $(this).data('account-type').toLowerCase();
                  if (selectedType === 'all' || accountType === selectedType) {
                      $(this).show();
                  } else {
                      $(this).hide();
                  }
              });
          });
      });
  
      $(document).ready(function() {
      // Initialize DataTable
      var table = $('#table2').DataTable({
          "paging": false, // Disable pagination if not needed
          "order": [[0, "asc"]], // Initial sorting by the first column (change as needed)
      });
  
      // Event listener for dropdown menu links
      $('.dropdown-item-filter-account-type').click(function() {
          // ... (your existing filtering logic)
  
          // Refresh DataTable after filtering
          table.draw();
      });
  
      // Event listener for sorting dropdown menu link
      $('.dropdown-item-sort').click(function() {
          var columnIndex = $(this).data('column-index');
  
          // Toggle between ascending and descending order
          var order = table.order()[0];
          if (order[0] === columnIndex) {
              order[1] = order[1] === 'asc' ? 'desc' : 'asc';
          } else {
              order = [columnIndex, 'asc'];
          }
  
          // Apply sorting
          table.order(order).draw();
      });
  });
      </script>
      
    <!-- share sccripts -->
  <script>
     function shareOnWhatsApp() {
      var url = window.location.href;
      var text = url;
      text = encodeURIComponent(text);
      var whatsappUrl = "whatsapp://send?text=" + text;
      window.location.href = whatsappUrl;
    }
  
  </script>
  
  <!-- print and pdf  and xcel scripts -->
  
  
  <script>
  function printSelectedArea2(area) {
    var printContents = document.getElementById("table1").innerHTML;
  var searchInput = document.getElementById('searchInput2');
  var mini = document.getElementById('mini');
  var stock = document.getElementById('stock');
  var value = document.getElementById('value');
  
  // Open a new window
  var printWindow = window.open('', '_blank');
  
  // Add styles to hide specific elements during printingox
  printWindow.document.write('<style>@media print { #searchInput2, #dropdownContent0,#dropdownContent1,#dropdownContent2,#dropdownContent3,#dropdownContent4,#dropdownContent5,#dropdownContent6 { display: none; } }</style>');
  printWindow.document.write('<style>@media print { #mini,#stock{ margin-left:70% ; } }</style>');
  printWindow.document.write('<style>@media print { #stock{ margin-top:-12% ; } }</style>');
  printWindow.document.write('<style>@media print { #mini{ margin-top:-28% ; } }</style>');
  printWindow.document.write('<style>@media print { #value,{ margin-left:50% } }</style>');
  // Add additional styles for the table layout
  printWindow.document.write('<style>table { border-collapse: collapse; width: 100%; }</style>');
  printWindow.document.write('<style>table, th, td { border: 1px solid black; }</style>');
  
  // Write the HTML content to the new window
  printWindow.document.write('<html><head><title>Print Data</title></head><body>');
  printWindow.document.write(document.getElementById('div-to-print').innerHTML);
  printWindow.document.write('</body></html>');
  
  // Print the new window
  printWindow.print();
  
  
  }
  
  
  
  function exportToPDF3() {
    // Get references to the elements
    var content = document.getElementById('div-to-print');
    var searchInput = document.getElementById('searchInput2');
    var fil = document.getElementById('fil');
    // var fil1 = document.getElementById('fil1');
    var fil2 = document.getElementById('fil2');
    var fil3 = document.getElementById('fil3');
    var fil4 = document.getElementById('fil4');
    var fil5 = document.getElementById('fil5');
    var fil6 = document.getElementById('fil6');
    var fil7 = document.getElementById('fil7');
    // Create a clone of the search input and hide it in the clone
    // var searchClone = searchInput.cloneNode(true);
    // searchClone.style.display = 'none';
    // content.appendChild(searchClone);
  
    // Apply styles to the content
    fil.style.display = 'none';
    // fil1.style.display = 'none';
    fil2.style.display = 'none';
    fil3.style.display = 'none';
    fil4.style.display = 'none';
    fil5.style.display = 'none';
    fil6.style.display = 'none';
    fil7.style.display = 'none';
  
    searchInput.style.display = 'none';
    content.style.backgroundColor = 'white';
    content.style.color = 'black';
  
    var heading = document.createElement('h1');
    // heading.textContent = '{{selitem.item_name}}' + '  ' + 'Transactions';
    heading.style.textAlign = 'center';
    heading.style.marginTop = '50px';
    heading.style.marginBottom = '20px';
    content.insertBefore(heading, content.firstChild);
  
    // Apply styles to h1 elements within the content
    var h1Elements = content.getElementsByTagName('h1');
    for (var i = 0; i < h1Elements.length; i++) {
      h1Elements[i].style.color = 'black';
    }
  
    // Generate PDF using html2pdf
    html2pdf()
      .from(content)
      .save('{{selitem.item_name}}' + '.pdf');
  
    // Remove the cloned search input after generating PDF
    content.removeChild(searchClone);
  }
  
  
  function exportToExcel() {
      var table = document.querySelector('#table1'); // Add # to select by ID
      var cellsToHide = [
          { id: 'dropdownContent0', content: 'HideThis' },
          { id: 'dropdownContent1', content: 'AnotherHiddenValue' },
          { id: 'dropdownContent2', content: 'HideThis' },
          { id: 'dropdownContent3', content: 'AnotherHiddenValue' },
          { id: 'dropdownContent4', content: 'HideThis' },
          { id: 'dropdownContent5', content: 'AnotherHiddenValue' },
          { id: 'dropdownContent6', content: 'HideThis' },
          { id: 'dropdownContent7', content: 'AnotherHiddenValue' },
          // Add more cell IDs and content as needed
      ];
  
      // Hide the specified content in cells
      for (var i = 0; i < cellsToHide.length; i++) {
          var cellInfo = cellsToHide[i];
          var cell = document.getElementById(cellInfo.id);
          
          if (cell) {
              cell.textContent = '';
          }
      }
      var ws = XLSX.utils.table_to_sheet(table);
      var wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');
      XLSX.writeFile(wb, 'item.xlsx');
  }
  
  var rdx = 1;
    function overview_function() {
        rdx = 1;
        document.getElementById("template2").style.display = "none";
        document.getElementById("template1").style.display = "none";
        document.getElementById("est_slip").style.display = "none";
        document.getElementById("div-to-pdf").style.display = "block";
        document.getElementById("template3").style.display = "none";

        document.querySelector('.active').classList.remove('active');
        document.getElementById("overviewBtn").classList.add('active');
        showOverviewButtons();

    }
  function template_function() {
        rdx = 1;
        document.getElementById("template2").style.display = "none";
        document.getElementById("template1").style.display = "block";
        document.getElementById("div-to-pdf").style.display = "none";
        document.getElementById("est_slip").style.display = "none";
        document.getElementById("template3").style.display = "none";
        document.querySelector('.active').classList.remove('active');
        document.getElementById("attachmentDropdown").classList.add('active');
        showTemplateButtons();

    }
    function show_template2() {
        rdx = 2;
        document.getElementById("est_slip").style.display = "none";
        document.getElementById("template1").style.display = "none";
        document.getElementById("div-to-pdf").style.display = "none";
        document.getElementById("template2").style.display = "block";
        document.getElementById("template3").style.display = "none";

    }
    function show_template3() {
        rdx = 3;
        document.getElementById("est_slip").style.display = "none";
        document.getElementById("template1").style.display = "none";
        document.getElementById("div-to-pdf").style.display = "none";
        document.getElementById("template2").style.display = "none";
        document.getElementById("template3").style.display = "block";

    }
    function show_slip() {
        rdx = 4;
        document.getElementById("template2").style.display = "none";
        document.getElementById("est_slip").style.display = "block";
        document.getElementById("template1").style.display = "none";
        document.getElementById("div-to-pdf").style.display = "none";
        document.getElementById("template3").style.display = "none";
        document.querySelector('.active').classList.remove('active');
        document.getElementById("slipBtn").classList.add('active'); 
    }



    function showOverviewButtons() {
        // Show overview buttons
        document.getElementById("overview_buttons").style.display = "block";
        // Hide other button sets
        document.getElementById("template_buttons").style.display = "none";
        document.getElementById("slip_buttons").style.display = "none";
    }
    function showTemplateButtons() {
        // Show template buttons
        document.getElementById("overview_buttons").style.display = "none";
        document.getElementById("template_buttons").style.display = "block";
        // Hide other button sets
        document.getElementById("slip_buttons").style.display = "none";
    }

    function showTemplate2Buttons() {
        // Show template 2 buttons
        document.getElementById("overview_buttons").style.display = "none";
        document.getElementById("template_buttons").style.display = "block";
        // Hide other button sets
        document.getElementById("slip_buttons").style.display = "none";
        // Implement logic to show/hide buttons as needed
    }

    function showTemplate3Buttons() {
        // Show template 3 buttons
        document.getElementById("overview_buttons").style.display = "none";
        document.getElementById("template_buttons").style.display = "block";
        // Hide other button sets
        document.getElementById("slip_buttons").style.display = "none";
        // Implement logic to show/hide buttons as needed
    }

    function showSlipButtons() {
        // Show slip buttons
        document.getElementById("overview_buttons").style.display = "none";
        document.getElementById("template_buttons").style.display = "none";
        document.getElementById("slip_buttons").style.display = "block";
    }
  </script>
  
  <!-- MOdal EMAIL -->
  
  <div class="modal fade" id="shareBillEmail">
    <div class="modal-dialog modal-xl">
      <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
        <div class="modal-header" style="background: rgb(32, 35, 37);">
          <h5 class="m-3 text-uppercase" id="shareBillEmailLabel" style="color: #fefefe;">Share Item Transactions Via Email</h5>
          <button type="button" class="close" style="width: 30px;" data-dismiss="modal" aria-label="Close"><span
              aria-hidden="true">&times;</span></button>
        </div>
        <div class="modal-body" style="background: rgb(32, 35, 37);">
          <div class="card p-3 m-3">
            <form action="" method="post" class="needs-validation"
              id="share_to_email_form" autocomplete="off">
              {% csrf_token %}
              <div class="form-group">
                <label for="emailIds" style="color: #000;">Email IDs</label>
                <textarea class="form-control text-dark"  style="color: #000;" name="email_ids" id="emailIds" rows="5"
                  placeholder="Multiple emails can be added by separating with a comma(,)." required></textarea>
              </div>
              <div class="form-group mt-2">
                <label for="item_unitname"  style="color: #000;">Message(optional)</label>
                <textarea name="email_message"  style="color: #000;" id="email_message" class="text-dark form-control" cols=""
                  rows="4" placeholder="This message will be sent along with Bill details."></textarea>
              </div>
       
          </div>
          <div class="modal-footer d-flex justify-content-center" style="border-top: 1px solid #ffff;">
            <!-- <button type="submit">submit</button> -->
            <input type="submit" id="share_with_email"
              class="submitShareEmailBtn rounded-pill text-grey w-50 my-4 mx-3" value="SEND MAIL">
          </div>
        </div>
      </form>
      </div>
    </div>
  </div>
  
  
  <!-- comment modal -->
  <div class="modal fade" id="cmnts">
    <div class="modal-dialog modal-xl">
      <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
        <div class="modal-header" style="background: rgb(32, 35, 37);">
          <h5 class="m-3 text-uppercase" id="shareBillEmailLabel" style="color: #fefefe;">Comments</h5>
          <button type="button" class="close" style="width: 30px;" data-dismiss="modal" aria-label="Close"><span
              aria-hidden="true">&times;</span></button>
        </div>
        <div class="modal-body" style="background: rgb(32, 35, 37);">
          <div class="card p-3 m-3">
            <form action="" method="post" class="needs-validation"
              id="share_to_email_form" autocomplete="off">
              {% csrf_token %}
              <div class="form-group">
                <label for="emailIds" style="color: #000;">Enter Comment</label>
                <textarea class="form-control text-dark"  style="color: #000;" name="comment" id="comment" rows="5"
                  placeholder="MEnter your comment here" required></textarea>
              </div>
             
       
          </div>
          <div class="modal-footer d-flex justify-content-center" style="border-top: 1px solid #ffff;">
            <!-- <button type="submit">submit</button> -->
            <input type="submit" id="share_with_email"
              class="submitShareEmailBtn rounded-pill text-grey w-50 my-4 mx-3"  style="background-color: #222121; color: #e1e1e1;" value="Save">
          </div>
        </div>
      </form>
      </div>
    </div>
  </div>
  <!-- History Modal  -->
<div class="modal fade" id="historyModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"  aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content" style="background-color: #3b3b3b;">
      <div class="modal-header">
        <h3 class="modal-title text-light" id="exampleModalLabel">HISTORY</h3>
        <button type="button" class="btn close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true" style="font-size: x-large;">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3" style="background-color: #000000;">
        <div class="container-fluid history-table-container" >
          <table class="table text-light table-borderless" style="margin:3px; background-color: #000000;width: 100%;">
            <thead>
              <tr>
                <th>#</th>
                <th>Date</th>
                <th>Action</th>
                <th>By</th>
              </tr>
            </thead>
            <tbody>
              {% for entry in history_entries %}
                  <tr>
                      <td>{{ forloop.counter }}</td> <!-- Incremental number -->
                      <td>{{ entry.modified_at }}</td> <!-- Date of the history entry -->
                      <td>{% if entry.created_at == entry.modified_at %}Created{% else %}Modified{% endif %}</td>
 <!-- Action performed -->
 <td>
  {% if entry.created_by %}
      {{ entry.created_by.first_name }} {{ entry.created_by.last_name }}
  {% elif entry.modified_by %}
      {{ entry.modified_by.first_name }} {{ entry.modified_by.last_name }}
  {% endif %}
</td> <!-- Username of the user who performed the action -->
 <!-- Username of the user who performed the action -->
                  </tr>
              {% endfor %}
          </tbody>
          
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-warning" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

  <div class="modal fade" id="cmt_list">
    <div class="modal-dialog modal-xl">
      <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
        <div class="modal-header" style="background: rgb(32, 35, 37);">
          <h5 class="m-3 text-uppercase" id="shareBillEmailLabel" style="color: #eeeaea;">Comments</h5>
          <button type="button" class="close" style="width: 30px;" data-dismiss="modal" aria-label="Close"><span
              aria-hidden="true">&times;</span></button>
        </div>
        <div class="modal-body" style="background: rgb(32, 35, 37);">
          <div class="card p-3 m-3" style="background-color: #000;">
          
            <table style="background-color: #000; margin-right: 10px; border-radius: 5px;">
              <thead class="text-white">
                  <tr>
                      <th style="color: rgb(250, 247, 242); padding-bottom: 10px;"><b>Comments</b></th>
                      <th style="color: rgb(244, 244, 244); padding-bottom: 10px;"><b></b></th>
                      <th style="color: rgb(250, 247, 242); padding-bottom: 10px;"><b>Delete</b></th>
                  </tr>
                  <tr>
                      <td colspan="3" style="border-bottom: 2px solid white; margin-bottom: 10px;"></td>
                  </tr>
              </thead>
          
              <tbody style="background-color: black; padding-top: 20px;"> <!-- Adjusted padding-top for spacing -->
                {% for i in est_comments %}
                      <tr style="background-color: black;height: 40px;">
                          <td class="text-white" style="color: rgb(0, 0, 0); background-color: black; padding-bottom: 10px;">{{ i.comments }}</td>            
                          <td class="text-white" style="color: rgb(0, 0, 0); background-color: black; padding-bottom: 10px;"></td>
                         
                      </tr>
                  {% endfor %}
              </tbody>
          </table>
   
  
  
      </div>
    </div>
  </div>
  </div>
  </div>
  <script>
    function sortTable(columnIndex) {
       const table = document.getElementById("table2");
       const tbody = table.getElementsByTagName('tbody')[0];
       const rows = Array.from(tbody.rows);
   
       rows.sort((row1, row2) => {
           const cellValue1 = row1.cells[columnIndex].textContent.toLowerCase();
           const cellValue2 = row2.cells[columnIndex].textContent.toLowerCase();
   
           if (cellValue1 < cellValue2) {
               return -1;
           } else if (cellValue1 > cellValue2) {
               return 1;
           } else {
               return 0;
           }
       });
   
       while (tbody.firstChild) {
           tbody.removeChild(tbody.firstChild);
       }
   
       rows.forEach(row => tbody.appendChild(row));
   }
   
   
   </script>
  
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
  <script>
    $(document).ready(function() {
      $('#searchInput').on('keyup', function() {
        var searchText = $(this).val().toLowerCase();
        $('#table2 tbody tr').each(function() {
          var itemData = $(this).text().toLowerCase();
          if (itemData.indexOf(searchText) === -1) {
            $(this).hide();
          } else {
            $(this).show();
          }
        });
      });
    });
  </script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
  <script>
    $(document).ready(function() {
      $('#searchInput2').on('keyup', function() {
        var searchText = $(this).val().toLowerCase();
        $('#table1 tbody tr').each(function() {
          var itemData = $(this).text().toLowerCase();
          if (itemData.indexOf(searchText) === -1) {
            $(this).hide();
          } else {
            $(this).show();
          }
        });
      });
    });
  </script>
  
  
  <script>
    function cleardropdown(index) {
      document.getElementById('filterInput' + index).value = '';
    }
  
    function toggleDropdown(index) {
      var dropdownContent = document.getElementById('dropdownContent' + index);
      var isVisible = dropdownContent.style.display === 'block';
      var allDropdowns = document.querySelectorAll('.dropdown-content');
      allDropdowns.forEach(function (dropdown) {
        dropdown.style.display = 'none';
      });
      dropdownContent.style.display = isVisible ? 'none' : 'block';
    }
  
    function filterTable(index) {
      var input;
      document.getElementById('dropdownContent' + index).style.display = 'none';
  
      if (index === 3) {
        input = document.getElementById('filterInput' + index).valueAsDate;
      } else {
        input = document.getElementById('filterInput' + index).value.toUpperCase();
      }
  
      var table = document.getElementById('table1');
      var rows = table.getElementsByTagName('tr');
      var emptyMessage = document.getElementById('emptyMessage');
      var isEmpty = true;
  
      for (var i = 1; i < rows.length; i++) {
        var cells = rows[i].getElementsByTagName('td');
        var cell = cells[index];
  
        if (cell) {
          var textValue = cell.textContent || cell.innerText;
  
          if (index === 3) {
            var dateVal = new Date(textValue);
            var inputDate = new Date(input);
  
            if (dateVal.toISOString().split('T')[0] === inputDate.toISOString().split('T')[0]) {
              rows[i].style.display = 'table-row';
              isEmpty = false;
            } else {
              rows[i].style.display = 'none';
            }
          } else {
            if (textValue.toUpperCase().includes(input)) {
              rows[i].style.display = 'table-row';
              isEmpty = false;
            } else {
              rows[i].style.display = 'none';
            }
          }
        }
      }
  
      emptyMessage.style.display = isEmpty ? 'block' : 'none';
      // You can add any additional logic or calculations here
    }
  </script>
  
  <!-- Add Comment  -->
<div class="modal fade" id="commentsModal">
  <div class="modal-dialog modal-lg">
    <div class="modal-content" style="background-color: #3b3b3b;">
      <div class="modal-header">
        <h3 class="modal-title text-light" id="exampleModalLabel">Add Comments</h3>
        <button type="button" class="btn close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true" style="font-size: x-large;">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3" style="background-color: #000;">
        <form action="{% url 'addRetainerInvoiceComment' retainer_id %}" method="post" class="needs-validation" novalidate enctype="multipart/form-data">
          {%csrf_token%}
          <div class="row mt-2">
            <div class="col-12">
              <textarea type="text" rows="4" class="form-control text-white" name="comment" placeholder="Add Comments.." required></textarea>
              {% if not comments %}
                <span class="my-2 font-weight-bold d-flex justify-content-center">No Comments.!</span>
                {% else %}
                <div class="container-fluid comments-table-container">
                    <table class="table table-borderless mt-4">
                        <thead>
                            <tr>
                                <th class="text-center">sl no.</th>
                                <th class="text-center">Comment</th>
                                <th class="text-center">Delete</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for c in comments %}
                            <tr class="">
                                <td class="text-center">{{forloop.counter }}</td>
                                <td class="text-center">{{c.comment}}</td>
                                <td class="text-center"><a class="text-danger" href="{% url 'deleteRetainerInvoiceComment' c.id %}" onclick="return confirm('Are you sure you want to delete.?')"><i class="fa fa-trash" style="font-size: 1.1rem;"></i></a></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
            </div>
          </div>
          <div class="row mt-3">
            <div class="col-md-4"></div>
            <div class="col-md-4">
              <div class="d-flex">
                <button class="btn save_btn btn-outline-warning mt-2 my-4 mx-2 w-50" type="submit">Save</button> 
                <input class="btn save_btn btn-outline-warning mt-2 my-4 mx-2 w-50" data-dismiss="modal" type="reset" value="Close">
              </div>
            </div>
            <div class="col-md-4"></div>
          </div>
        </form>
      </div>
      <div class="modal-footer"></div>
    </div>
  </div>
</div>
  
  
  <div class="modal fade" id="commentModal2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"  aria-hidden="true" style="margin-top: 8vh;width: 100%;">
    <div class="modal-dialog modal-xl">
      <div class="modal-content" style="background-color: #3b3b3b;">
        <div class="modal-header">
          <h3 class="modal-title text-light" id="exampleModalLabel">HISTORY</h3>
          <button type="button" class="btn close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true" style="font-size: x-large;">&times;</span>
          </button>
        </div>
        <div class="modal-body">
        <div class="container " >
          <table class="table text-light table-borderless " style="margin:3px; background-color: #000000;width: 100%;">
            <thead>
              <tr>
                <th>
                  sl
                </th>
                <th>
                  Date
                </th>
                <th>
                  Action
                </th>
                <th>
                  By
                </th>
              </tr>
            </thead>
            <tbody>
              {% for i in latest_item_id %}
              <tr>
                <td>{{forloop.counter}}</td>
                <td>{{i.Date}}</td>
                <td>{{i.action}}</td>
                <td>{{ i.logindetails.first_name }}&nbsp;{{ i.logindetails.last_name }}</td>
              </tr>
              {% endfor %}
            </tbody>  
          </table>
        </div>
      </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-warning" data-dismiss="modal">Close</button>
  
        </div>
      </div>
    </div>
  </div>
  </div>


  <!-- Add Document  -->
  <div class="modal fade" id="retainer_files">
    <div class="modal-dialog" style="max-width: 800px;">
        <div class="modal-content" style="background-color: #3b3b3b;">
            <div class="modal-header">
                <h3 class="modal-title text-light" id="exampleModalLabel">Add Documents</h3>
                <button type="button" class="btn close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true" style="font-size: x-large;">&times;</span>
                </button>
            </div>
            <div class="modal-body mx-3" style="background-color: #000;">
                <form action="{% url 'attachRetainerInvoiceFile' invoice.id %}" method="post" class="needs-validation" novalidate enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="row mt-2">
                        <div class="col-md-3">
                            <label class="pt-2" for="origin" style="color: white;">Add File</label>
                        </div>
                        <div class="col-md-9">
                            <input type="file" class="form-control text-white bg-black" name="file" id="filess">
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-4"></div>
                        <div class="col-md-4">
                            <div class="d-flex">
                                <button class="btn save_btn btn-outline-warning mt-2 my-4 mx-2 w-50" type="submit">Save</button>
                                <input class="btn save_btn btn-outline-warning mt-2 my-4 mx-2 w-50" data-dismiss="modal" type="reset" value="Reset">
                            </div>
                        </div>
                        <div class="col-md-4"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer"></div>
        </div>
    </div>
</div>


<!-- Share Email  -->
<div class="modal fade" id="shareToEmail" >
  <div class="modal-dialog" style="max-width: 800px;">
    <div class="modal-content" style="background-color: #3b3b3b;">
      <div class="modal-header">
        <h3 class="modal-title text-light" id="exampleModalLabel">Share Recurring Invoice</h3>
        <button type="button" class="btn close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true" style="font-size: x-large;">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3" style="background-color: #000;">
        <form action="{% url 'shareRetainerInvoiceToEmail' invoice.id %}" method="post" id="share_to_email_form" class="needs-validation" novalidate enctype="multipart/form-data">
          {%csrf_token%}
          <div class="form-group">
              <label for="emailIds">Email IDs</label>
              <textarea class="form-control" name="email_ids" id="emailIds" rows="3" placeholder="Multiple emails can be added by separating with a comma(,)." required></textarea>
          </div>
          <div class="form-group mt-2">
              <label for="item_unitname">Message(optional)</label>
              <textarea name="email_message" id="email_message" class="form-control" cols="" rows="4" placeholder="This message will be sent along with Bill details."></textarea>
          </div>
          <div class="row mt-3">
            <div class="col-md-4"></div>
            <div class="col-md-4">
              <div class="d-flex">
                <button class="btn save_btn btn-outline-warning mt-2 my-4 mx-2 w-50" type="button" id="share_with_email">Save</button> 
                <input class="btn save_btn btn-outline-warning mt-2 my-4 mx-2 w-50" data-dismiss="modal" type="reset" value="Close">
              </div>
            </div>
            <div class="col-md-4"></div>
          </div>
        </form>
      </div>
      <div class="modal-footer"></div>
    </div>
  </div>
</div>

<script>
  function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = cookies[i].trim();
            // Check if this cookie name is the one we are looking for
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

 $(document).ready(function() {
    $("#shareToEmail").on("click", "#share_with_email", function() {
        console.log("Save button clicked");
        var emailIds = $("#emailIds").val();
        var emailMessage = $("#email_message").val();
        var formData = new FormData();
        formData.append("email_ids", emailIds);
        formData.append("email_message", emailMessage);
        $.ajax({
            url: "{% url 'shareRetainerInvoiceToEmail' invoice.id %}",
            method: "POST",
            headers: { "X-CSRFToken": getCookie("csrftoken") }, // Include CSRF token
            data: formData,
            processData: false,
            contentType: false,
            success: function(response) {
                // Handle success response, such as showing a success message
                alert("Email sent successfully!");
                $("#shareToEmail").modal("hide");
            },
            error: function(xhr, status, error) {
                // Handle error response, such as showing an error message
                console.error(error);
                alert("Failed to send email. Please try again later.");
            }
        });
    });
});
p = rdx;
    function printSelectedArea(p) {

        console.log(p);
        if (p === 1) {
            var printContents = document.getElementById("selected-area").innerHTML;
            document.getElementById("selected-area").style.backgroundColor = "white"
            var $printerDiv = $('<div class="printContainer bg-white style="display:block !important;"></div>'); // create the div that will contain the stuff to be printed
            $printerDiv.html(printContents); // add the content to be printed
            $('body').append($printerDiv).addClass("printingContent"); // add the div to body, and make the body aware of printing (we apply a set of css styles to the body to hide its contents)

            window.print(); // call print
            $printerDiv.remove(); // remove the div
            $('body').removeClass("printingContent");
        } if (p === 2) {
            var printContents = document.getElementById("selected-area2").innerHTML;
            document.getElementById("selected-area2").style.backgroundColor = "white"
            var $printerDiv = $('<div class="printContainer bg-white style="display:block !important;"></div>'); // create the div that will contain the stuff to be printed
            $printerDiv.html(printContents); // add the content to be printed
            $('body').append($printerDiv).addClass("printingContent"); // add the div to body, and make the body aware of printing (we apply a set of css styles to the body to hide its contents)

            window.print(); // call print
            $printerDiv.remove(); // remove the div
            $('body').removeClass("printingContent");
        } if (p === 3) {
            var printContents = document.getElementById("selected-area3").innerHTML;
            document.getElementById("selected-area3").style.backgroundColor = "white"
            var $printerDiv = $('<div class="printContainer bg-white style="display:block !important;"></div>'); // create the div that will contain the stuff to be printed
            $printerDiv.html(printContents); // add the content to be printed
            $('body').append($printerDiv).addClass("printingContent"); // add the div to body, and make the body aware of printing (we apply a set of css styles to the body to hide its contents)

            window.print(); // call print
            $printerDiv.remove(); // remove the div
            $('body').removeClass("printingContent");
        } if (p === 4) {
            var printContents = document.getElementById("printslip").innerHTML;
            document.getElementById("printslip").style.backgroundColor = "white"
            var $printerDiv = $('<div class="printContainer bg-white style="display:block !important;"></div>'); // create the div that will contain the stuff to be printed
            $printerDiv.html(printContents); // add the content to be printed
            $('body').append($printerDiv).addClass("printingContent"); // add the div to body, and make the body aware of printing (we apply a set of css styles to the body to hide its contents)

            window.print(); // call print
            $printerDiv.remove(); // remove the div
            $('body').removeClass("printingContent");
        }
    }

    // Get the button element
    var printButton = document.getElementById("print-button");

    // Add an event listener to the button for the click event
    printButton.addEventListener("click", function () {
        printSelectedArea(rdx); // Call the printSelectedArea function on button click
    });

function exportToPDF(p) {
        if (p === 1) {
            var content = document.getElementById('selected-area');
            html2pdf()
                .from(content)
                .save('Retainer_invoice.pdf')
        }
        if (p === 2) {
            var content = document.getElementById('selected-area2');
            html2pdf()
                .from(content)
                .save('Retainer_invoice.pdf')
        }
        if (p === 3) {
            var content = document.getElementById('selected-area3');
            html2pdf()
                .from(content)
                .save('Retainer_invoice.pdf')
        }
        if (p === 4) {
            var content = document.getElementById('printslip');
            html2pdf()
                .from(content)
                .save('Retainer_invoice.pdf')
        }
    }

    var pdftButton = document.getElementById("pdf-button");

    // Add an event listener to the button for the click event
    pdftButton.addEventListener("click", function () {
        exportToPDF(rdx); // Call the printSelectedArea function on button click
    });
    function convertToSaved(invoiceId) {
  if (confirm('Do you want to convert this Draft to Saved?')) {
    // Assuming you have a URL named 'convertRecurringInvoice'
    window.location.href = "{% url 'convertRetainerInvoice' 999 %}".replace('999', invoiceId);

  }
}

$(document).ready(function(){
    $('#history_btn').on('click', function() {
        var retainerId = $(this).data('retainer-id');
        $.ajax({
          url: '/retainer/' + retainerId + '/history/',
            type: 'GET',
            success: function(data) {
                // Update the modal content with history data
                $('#historyModal .modal-body').html(
                    '<p>Created By: ' + data.history.created_by + '</p>' +
                    '<p>Created At: ' + data.history.created_at + '</p>' +
                    '<p>Modified By: ' + data.history.modified_by + '</p>' +
                    '<p>Modified At: ' + data.history.modified_at + '</p>'
                );
            },
            error: function(xhr, status, error) {
                // Handle error
            }
        });
    });
});


$(document).ready(function() {
    // Add click event listener to table rows
    $('.clickable').click(function() {
        // Extract the ID of the clicked invoice
        var invoiceId = $(this).attr('id');

        // Redirect the user to the detailed view page of the clicked invoice
        window.location.href = "{% url 'retaineroverview' pk=invoice.id %}";

    });
});

function sortTable() {
        var table, rows, switching, i, x, y, shouldSwitch;
        table = document.getElementById("table2");
        switching = true;
        /* Make a loop that will continue until no switching has been done: */
        while (switching) {
            // Start by saying: no switching is done:
            switching = false;
            rows = table.rows;
            /* Loop through all table rows (except the first, which contains table headers): */
            for (i = 1; i < (rows.length - 1); i++) {
                // Start by saying there should be no switching:
                shouldSwitch = false;
                /* Get the two elements you want to compare, one from current row and one from the next: */
                x = rows[i].getElementsByTagName("TD")[0];
                y = rows[i + 1].getElementsByTagName("TD")[0];
                // Check if the two rows should switch place:
                if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                    // If so, mark as a switch and break the loop:
                    shouldSwitch = true;
                    break;
                }
            }
            if (shouldSwitch) {
                /* If a switch has been marked, make the switch and mark that a switch has been done: */
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
            }
        }
    }

    function sortTablebybillno() {
        var table, rows, switching, i, x, y, shouldSwitch;
        table = document.getElementById("table2");
        switching = true;
        /* Make a loop that will continue until no switching has been done: */
        while (switching) {
            // Start by saying: no switching is done:
            switching = false;
            rows = table.rows;
            /* Loop through all table rows (except the first, which contains table headers): */
            for (i = 1; i < (rows.length - 1); i++) {
                // Start by saying there should be no switching:
                shouldSwitch = false;
                /* Get the two elements you want to compare, one from current row and one from the next: */
                x = rows[i].getElementsByTagName("TD")[1];
                y = rows[i + 1].getElementsByTagName("TD")[1];
                // Check if the two rows should switch place:
                if (Number(x.innerHTML) > Number(y.innerHTML)) {
                    // If so, mark as a switch and break the loop:
                    shouldSwitch = true;
                    break;
                }
            }
            if (shouldSwitch) {
                /* If a switch has been marked, make the switch and mark that a switch has been done: */
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
            }
        }
    }


    $(document).ready(function () {
    $("#fileSave").click(function () {
      var formData = new FormData();
      formData.append('id', $("#file_id").val());
      formData.append('file', $("#filess")[0].files[0]); 
      formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');

      $.ajax({
        type: 'POST',
        url: "",
        data: formData,
        processData: false,
        contentType: false,
        success: function (response) {
          document.getElementById("modalAddfile").reset();
          location.reload();
        },
      });
    });
  });
</script>

{% endblock %}